{% extends 'CollegeFootballTeamBundle:Ranking:layout.html.twig' %}

{% block content %}
    <div class="panel panel-default">
        <div class="panel-heading">
            <a href="{{ path('collegefootball_team_ranking_index', {'week': week.id}) }}">
                Rankings
            </a>
            |
            Manage {{ week }}
        </div>
        {{ form_start(form) }}
            <table class="table table-striped">
                <thead>
                    <th></th>
                    <th>Team</th>
                    <th>AP</th>
                    <th>Coaches Poll</th>
                </thead>
                <tbody id="js-rankings" data-team-prototype="{{ form_widget(form.rankings.vars.prototype.children.team)|e }}" data-ap-prototype="{{ form_widget(form.rankings.vars.prototype.children.apRank)|e }}" data-coach-prototype="{{ form_widget(form.rankings.vars.prototype.children.coachesPollRank)|e }}">
                    {% for ranking in form.rankings %}
                        <tr>
                            <td>{{ loop.index }}</td>
                            <td>{{ ranking.team }}</td>
                            <td>{{ ranking.apRank }}</td>
                            <td>{{ ranking.coachesPollRank }}</td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
            <div class="panel-body">
                <button type="submit" class="btn btn-primary pull-right">
                    {{ icon('checkmark') }}
                    Save
                </button>
            </div>
            <div style="display: none;">
                {{ form_rest(form) }}
            </div>
    {{ form_end(form) }}
    </div>
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script>
        $(function(){
            var rankingTable = $('#js-rankings');

            var newWidget;

            for (var i = 0; i < 30; i++) {
                var teamWidget            = rankingTable.data('team-prototype');
                var apRankWidget          = rankingTable.data('ap-prototype');
                var coachesPollRankWidget = rankingTable.data('coach-prototype');

                teamWidget            = teamWidget.replace(/__name__/g, i);
                apRankWidget          = apRankWidget.replace(/__name__/g, i);
                coachesPollRankWidget = coachesPollRankWidget.replace(/__name__/g, i);

                apRankWidget          = apRankWidget.replace('/', 'value="' + (i+1) + '"');
                coachesPollRankWidget = coachesPollRankWidget.replace('/', 'value="' + (i+1) + '"');

                var newRow = $('<tr><td style="font-size: 1.8em; text-align: center; line-height: 1.8em;">' + (i+1) + '</td><td>' + teamWidget + '</td><td>' + apRankWidget + '</td><td>' + coachesPollRankWidget + '</td></tr>');

                newRow.appendTo(rankingTable);
            }
        })
    </script>
{% endblock %}
